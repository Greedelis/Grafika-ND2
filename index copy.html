<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Three JS Example</title>
    <script type="text/javascript" src="libs/three.js"></script>
    <script type="text/javascript" src="libs/jquery-1.9.0.js"></script>
    <script type="text/javascript" src="libs/OrbitControls.js"></script>
    
    <script type="text/javascript" src="libs/stats.js"></script>
    <script type="text/javascript" src="libs/dat.gui.js"></script>
    <style>
        body{
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
  </head>
  <body>

    <div id="WebGL-output">
    </div>
    <script type="text/javascript">

    $(function () {
      class laiptelis{
        static step;
        static extrude_settings;
        static geometry;
        static mesh;
        constructor(){
          this.step = new THREE.Shape();
          this.step.moveTo(0, 1);
          this.step.quadraticCurveTo(0, 0, 1, 0);
          this.step.lineTo(19, 0);
          this.step.quadraticCurveTo(20, 0, 20, 1);
          this.step.lineTo(20, 3);
          this.step.quadraticCurveTo(20, 4, 19, 5);
          this.step.quadraticCurveTo(10, 10, 1, 10);
          this.step.quadraticCurveTo(0, 10, 0, 9);
          this.step.lineTo(0, 1);

          this.extrude_settings = {
            steps: 1,
            depth: 2,
            bevelEnabled: false,
            bevelThickness: 1,
            bevelSize: 1,
            bevelOffset: 0,
            bevelSegments: 1
          }
          this.geometry = new THREE.ExtrudeBufferGeometry( this.step, this.extrude_settings );
          this.mesh = new THREE.Mesh( this.geometry, new THREE.MeshBasicMaterial ({color: 0xaa00ff}) );
        } 
      }

      class metalo_construkcija{
        static group;
        static single_geometry;
        static single_material;
        static single;
        static cube_geometry;
        static cube_mesh;
        static cilinder_geometry1;
        static cilinder_geometry2;
        static cilinder_mesh1;
        static cilinder_mesh2;
        static cube_len;
        static step;
        constructor(step, dist){
          this.cube_len = dist;
          this.step = new laiptelis()
          this.cilinder_geometry1 = new THREE.CylinderGeometry(2, 2, 5, 25);
          this.cilinder_geometry2 = new THREE.CylinderGeometry(1.8, 1.8, 5, 25);
          this.cube_geometry = new THREE.CubeGeometry(this.cube_len, 1, 3.6);
          this.single_material = new THREE.MeshBasicMaterial ({color: 0x0000ff});
          this.cube_mesh = new THREE.Mesh(this.cube_geometry, new THREE.MeshBasicMaterial ({color: 0xff00ff}));
          this.cilinder_mesh1 = new THREE.Mesh(this.cilinder_geometry1, this.single_material);
          this.cilinder_mesh2 = new THREE.Mesh(this.cilinder_geometry2, new THREE.MeshBasicMaterial ({color: 0xffaaaa}));
          this.group = new THREE.Group();
          this.cube_mesh.position.set(this.cilinder_mesh1.position.x + this.cube_len/2,this.cilinder_mesh1.position.x + 2 ,0);
          if (step % 2 == 0){
            this.step.mesh.position.set(3, 4.5, -10)
            this.step.mesh.rotation.x = 90 * Math.PI / 180;
            this.step.mesh.rotation.z = 90 * Math.PI / 180;
          }
          else {
            this.step.mesh.position.set(3, 2.5, 10)
            this.step.mesh.rotation.x = 270 * Math.PI / 180;
            this.step.mesh.rotation.z = Math.PI / 2;
          }
          
          this.cilinder_mesh2.position.set(this.cube_len, 4, 0);
          this.group.add(this.cube_mesh);
          this.group.add(this.cilinder_mesh1);
          this.group.add(this.cilinder_mesh2);
          this.group.add(this.step.mesh);
         
        }
        set_position(x, y, z){
          this.group.position.set(x,y,z);
        }
       
      }
      const path = [(0,0,0), (1,1,1)];
      var scene = new THREE.Scene();
      var camera = new THREE.PerspectiveCamera( 
          75, 
          window.innerWidth / window.innerHeight, 
          0.1, 
          1000 );

      var renderer = new THREE.WebGLRenderer();
      renderer.setClearColor(0xEEEEEE);
      const datGui  = new dat.GUI({ autoPlace: true });
  
      datGui.domElement.id = 'gui' 
      renderer.setSize( window.innerWidth, window.innerHeight );
      var controls = new THREE.OrbitControls( camera, renderer.domElement );
      let dalys = [];
      var params = new function(){
        this.deg = 0;
        this.step_count = 10;
        this.radius = 5;
      }
      init();

      datGui.add(params, "step_count", 3, 40).onChange(function(){
        init();
      });
      datGui.add(params, "deg", -360, 360);
      datGui.add(params, "radius", 5, 20).onChange(function(){
        init();
      });
      camera.position.y = 40;
      camera.lookAt(0, 0, 0);
      function animate(){
        requestAnimationFrame(animate);
        let vec = new THREE.Vector3();
        dalys[0].group.rotation.y = 0;
        for(i = 1; i < params.step_count; i++){
          dalys[i].group.rotation.y = (params.deg/(params.step_count)) * i * Math.PI/180;
          dalys[i-1].cilinder_mesh2.getWorldPosition(vec);
          dalys[i].group.position.set(vec.x,vec.y+1,vec.z);
        } 
        controls.update();
        renderer.render(scene, camera);
      }

      $("#WebGL-output").append(renderer.domElement);
      animate();

      function init(){
        dalys = [];
        scene = new THREE.Scene();
        for(i = 0; i < params.step_count; i++){
          dalys.push(new metalo_construkcija(i, params.radius));
          //scene.add(dalys[i].group);
        } 
        //scene.add(steps.mesh);
      }
  });




  </script>
  </body>
</html>
